# 数据统计功能技术架构文档

## 1. 架构设计

```mermaid
graph TD
    A[管理员浏览器] --> B[Vue 3 前端应用]
    B --> C[Arco Design Vue 组件]
    B --> D[统计API客户端]
    D --> E[Laravel后端API]
    E --> F[统计控制器]
    F --> G[数据记录模型]
    G --> H[MySQL数据库]

    subgraph "前端层"
        B
        C
        D
    end

    subgraph "后端层"
        E
        F
        G
    end

    subgraph "数据层"
        H
    end
```

## 2. 技术描述

- **前端**：Vue 3 + TypeScript + Arco Design Vue + Vite + ECharts
- **后端**：Laravel 10 + PHP 8.1 + Sanctum认证
- **数据库**：MySQL 8.0
- **图表库**：ECharts 5.x（用于数据可视化）

## 3. 路由定义

| 路由 | 用途 |
|------|------|
| /admin/claim-statistics | 领取统计页面，显示数据领取和通过情况 |
| /admin/collection-statistics | 收集统计页面，显示数据收集和质量情况 |

## 4. API定义

### 4.1 领取统计API

**获取领取统计数据**
```
GET /api/statistics/claims
```

请求参数：
| 参数名 | 参数类型 | 是否必需 | 描述 |
|--------|----------|----------|------|
| date | string | false | 查询日期，格式：YYYY-MM-DD，默认当天 |
| start_date | string | false | 开始日期，格式：YYYY-MM-DD |
| end_date | string | false | 结束日期，格式：YYYY-MM-DD |

响应数据：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| total_records | integer | 总数据量 |
| claimed_records | integer | 已领取数据量 |
| completed_records | integer | 已通过数据量 |
| completion_rate | float | 通过率（百分比） |
| user_statistics | array | 用户统计列表 |

示例响应：
```json
{
  "success": true,
  "data": {
    "total_records": 1000,
    "claimed_records": 800,
    "completed_records": 600,
    "completion_rate": 75.0,
    "user_statistics": [
      {
        "user_id": 1,
        "user_name": "张三",
        "claimed_count": 50,
        "completed_count": 40,
        "completion_rate": 80.0
      }
    ]
  }
}
```

### 4.2 收集统计API

**获取收集统计数据**
```
GET /api/statistics/collections
```

请求参数：
| 参数名 | 参数类型 | 是否必需 | 描述 |
|--------|----------|----------|------|
| date | string | false | 查询日期，格式：YYYY-MM-DD，默认当天 |
| start_date | string | false | 开始日期，格式：YYYY-MM-DD |
| end_date | string | false | 结束日期，格式：YYYY-MM-DD |

响应数据：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| total_records | integer | 总数据量 |
| claimed_records | integer | 已领取数据量 |
| completed_records | integer | 已通过数据量 |
| completion_rate | float | 通过率（百分比） |
| duplicate_records | integer | 重复数据量 |
| duplicate_rate | float | 重复率（百分比） |
| user_statistics | array | 用户统计列表 |

示例响应：
```json
{
  "success": true,
  "data": {
    "total_records": 1000,
    "claimed_records": 800,
    "completed_records": 600,
    "completion_rate": 75.0,
    "duplicate_records": 50,
    "duplicate_rate": 5.0,
    "user_statistics": [
      {
        "user_id": 1,
        "user_name": "张三",
        "submitted_count": 100,
        "duplicate_count": 5,
        "duplicate_rate": 5.0
      }
    ]
  }
}
```

## 5. 服务器架构图

```mermaid
graph TD
    A[前端请求] --> B[路由中间件]
    B --> C[认证中间件]
    C --> D[管理员权限中间件]
    D --> E[统计控制器]
    E --> F[统计服务层]
    F --> G[数据访问层]
    G --> H[(数据库)]

    subgraph "Laravel应用"
        B
        C
        D
        E
        F
        G
    end
```

## 6. 数据模型

### 6.1 数据模型定义

统计功能主要基于现有的数据记录表，不需要新增表结构：

```mermaid
erDiagram
    DATA_RECORDS ||--o{ USERS : "submitted_by/claimed_by"
    
    DATA_RECORDS {
        int id PK
        string title
        text content
        string submitter_name
        int submitter_id FK
        string phone
        string platform
        string category
        string priority
        json tags
        json attachments
        text remarks
        boolean is_claimed
        int claimer_id FK
        datetime claimed_at
        boolean is_completed
        datetime completed_at
        boolean is_duplicate
        datetime created_at
        datetime updated_at
    }
    
    USERS {
        int id PK
        string name
        string account
        string email
        string role
        datetime created_at
        datetime updated_at
    }
```

### 6.2 统计查询逻辑

**领取统计查询**：
- 总数据：按日期筛选的所有数据记录
- 已领取数据：is_claimed = true 的记录
- 已通过数据：is_completed = true 的记录
- 通过率：已通过数据 / 已领取数据 * 100%
- 用户统计：按 claimer_id 分组统计

**收集统计查询**：
- 总数据：按日期筛选的所有数据记录
- 已领取数据：is_claimed = true 的记录
- 已通过数据：is_completed = true 的记录
- 通过率：已通过数据 / 总数据 * 100%
- 重复数据：is_duplicate = true 的记录
- 重复率：重复数据 / 总数据 * 100%
- 用户统计：按 submitter_id 分组统计