# 接口参数文档补充

## 文档信息

- **文档版本**: v1.0.0
- **创建日期**: 2024-01-22
- **接口数量**: 2个
- **适用系统**: 数据收集管理系统

## 目录

1. [创建数据记录接口](#1-创建数据记录接口)
2. [图片上传接口](#2-图片上传接口)

---

## 1. 创建数据记录接口

### 1.1 接口信息

- **接口路径**: `POST /api/data-records`
- **接口描述**: 创建新的数据记录，支持自动去重检测
- **认证要求**: 需要Bearer Token认证
- **请求方式**: POST
- **Content-Type**: `application/json`

### 1.2 请求头

```
Authorization: Bearer {token}
Content-Type: application/json
```

### 1.3 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| image_url | string | 是 | 图片URL地址 |
| platform | string | 是 | 来源平台 |
| platform_id | string | 是 | 平台ID |

#### 参数验证规则

- `image_url`: 
  - 必填字段
  - 必须是有效的URL格式
  - 示例：`https://example.com/image.jpg`

- `platform`: 
  - 必填字段
  - 枚举值：`douyin`（抖音）、`xiaohongshu`（小红书）、`taobao`（淘宝）、`xianyu`（闲鱼）

- `platform_id`: 
  - 必填字段
  - 字符串类型
  - 最大长度：255个字符
  - 用于标识平台上的具体内容

#### 去重规则

系统会自动检测重复记录：

1. **检测条件**: 相同平台（platform）+ 相同平台ID（platform_id）
2. **时间窗口**: 3天内（包括当天）
3. **处理逻辑**:
   - 3天内的相同记录：标记为重复（`is_duplicate: true`）
   - 超过3天的相同记录：视为新客资（`is_duplicate: false`）

### 1.4 请求示例

#### 1.4.1 cURL 示例

```bash
curl -X POST http://localhost:8000/api/data-records \
  -H "Authorization: Bearer 1|abcdefghijklmnopqrstuvwxyz123456789" \
  -H "Content-Type: application/json" \
  -d '{
    "image_url": "https://example.com/images/product.jpg",
    "platform": "douyin",
    "platform_id": "DY123456789"
  }'
```

#### 1.4.2 JavaScript 示例

```javascript
const createDataRecord = async (recordData) => {
  try {
    const response = await fetch('http://localhost:8000/api/data-records', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer 1|abcdefghijklmnopqrstuvwxyz123456789',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        image_url: recordData.imageUrl,
        platform: recordData.platform,
        platform_id: recordData.platformId
      })
    });

    const result = await response.json();
    
    if (result.success) {
      console.log('创建成功:', result.data);
      return result.data;
    } else {
      console.error('创建失败:', result.message);
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('请求失败:', error);
    throw error;
  }
};

// 使用示例
createDataRecord({
  imageUrl: 'https://example.com/images/product.jpg',
  platform: 'douyin',
  platformId: 'DY123456789'
});
```

#### 1.4.3 Vue 3 示例

```vue
<template>
  <div class="create-record-form">
    <form @submit.prevent="submitRecord">
      <div class="form-group">
        <label for="imageUrl">图片URL:</label>
        <input 
          id="imageUrl"
          v-model="form.imageUrl" 
          type="url" 
          required 
          placeholder="https://example.com/image.jpg"
        />
      </div>
      
      <div class="form-group">
        <label for="platform">来源平台:</label>
        <select id="platform" v-model="form.platform" required>
          <option value="">请选择平台</option>
          <option value="douyin">抖音</option>
          <option value="xiaohongshu">小红书</option>
          <option value="taobao">淘宝</option>
          <option value="xianyu">闲鱼</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="platformId">平台ID:</label>
        <input 
          id="platformId"
          v-model="form.platformId" 
          type="text" 
          required 
          maxlength="255"
          placeholder="请输入平台ID"
        />
      </div>
      
      <button type="submit" :disabled="isSubmitting">
        {{ isSubmitting ? '创建中...' : '创建记录' }}
      </button>
    </form>
    
    <!-- 重复提示 -->
    <div v-if="duplicateWarning" class="warning">
      ⚠️ 检测到可能的重复记录，系统已自动标记
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive } from 'vue'
import axios from 'axios'

// 表单数据
const form = reactive({
  imageUrl: '',
  platform: '',
  platformId: ''
})

// 状态管理
const isSubmitting = ref(false)
const duplicateWarning = ref(false)

// 提交记录
const submitRecord = async () => {
  isSubmitting.value = true
  duplicateWarning.value = false
  
  try {
    const response = await axios.post('/api/data-records', {
      image_url: form.imageUrl,
      platform: form.platform,
      platform_id: form.platformId
    }, {
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`
      }
    })
    
    if (response.data.success) {
      console.log('创建成功:', response.data.data)
      
      // 检查是否为重复记录
      if (response.data.data.is_duplicate) {
        duplicateWarning.value = true
      }
      
      // 重置表单
      Object.assign(form, {
        imageUrl: '',
        platform: '',
        platformId: ''
      })
      
      // 可以触发成功回调或跳转
      // emit('recordCreated', response.data.data)
    }
  } catch (error) {
    console.error('创建失败:', error.response?.data || error.message)
    
    // 处理验证错误
    if (error.response?.status === 422) {
      const errors = error.response.data.errors
      console.log('验证错误:', errors)
      // 显示具体的验证错误信息
    }
  } finally {
    isSubmitting.value = false
  }
}
</script>

<style scoped>
.create-record-form {
  max-width: 500px;
  margin: 0 auto;
  padding: 20px;
}

.form-group {
  margin-bottom: 15px;
}

.form-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
}

.form-group input,
.form-group select {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
}

button {
  width: 100%;
  padding: 10px;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 16px;
  cursor: pointer;
}

button:disabled {
  background-color: #6c757d;
  cursor: not-allowed;
}

.warning {
  margin-top: 15px;
  padding: 10px;
  background-color: #fff3cd;
  border: 1px solid #ffeaa7;
  border-radius: 4px;
  color: #856404;
}
</style>
```

### 1.5 响应示例

#### 1.5.1 创建成功 (201)

```json
{
  "success": true,
  "message": "创建数据记录成功",
  "data": {
    "id": 123,
    "image_url": "https://example.com/images/product.jpg",
    "submitter_id": 1,
    "platform": "douyin",
    "platform_id": "DY123456789",
    "is_claimed": false,
    "is_completed": false,
    "claimer_id": null,
    "is_duplicate": false,
    "created_at": "2024-01-20T10:30:00.000000Z",
    "updated_at": "2024-01-20T10:30:00.000000Z",
    "submitter": {
      "id": 1,
      "name": "张三",
      "email": "zhangsan@example.com"
    },
    "claimer": null,
    "platform_name": "抖音",
    "status_description": "待领取"
  }
}
```

#### 1.5.2 重复记录创建成功 (201)

```json
{
  "success": true,
  "message": "创建数据记录成功",
  "data": {
    "id": 124,
    "image_url": "https://example.com/images/product.jpg",
    "submitter_id": 1,
    "platform": "douyin",
    "platform_id": "DY123456789",
    "is_claimed": false,
    "is_completed": false,
    "claimer_id": null,
    "is_duplicate": true,
    "created_at": "2024-01-20T10:35:00.000000Z",
    "updated_at": "2024-01-20T10:35:00.000000Z",
    "submitter": {
      "id": 1,
      "name": "张三",
      "email": "zhangsan@example.com"
    },
    "claimer": null,
    "platform_name": "抖音",
    "status_description": "重复记录"
  }
}
```

#### 1.5.3 参数验证失败 (422)

```json
{
  "success": false,
  "message": "参数验证失败",
  "errors": {
    "image_url": ["图片URL不能为空"],
    "platform": ["来源平台必须是：douyin, xiaohongshu, taobao, xianyu"],
    "platform_id": ["平台ID不能为空"]
  }
}
```

#### 1.5.4 认证失败 (401)

```json
{
  "success": false,
  "message": "未认证"
}
```

#### 1.5.5 服务器错误 (500)

```json
{
  "success": false,
  "message": "创建数据记录失败",
  "error": "数据库连接失败"
}
```

### 1.6 业务逻辑说明

1. **自动去重机制**:
   - 基于平台和平台ID进行去重检测
   - 3天内的重复记录会被标记为 `is_duplicate: true`
   - 超过3天的相同记录视为新客资，不标记重复

2. **记录状态**:
   - 新创建的记录默认为"待领取"状态
   - `is_claimed: false` - 未被领取
   - `is_completed: false` - 未完成
   - `is_duplicate` - 根据去重规则自动设置

3. **用户关联**:
   - `submitter_id` 自动设置为当前认证用户
   - `claimer_id` 初始为空，等待其他用户领取

### 1.7 使用说明

1. **前端集成建议**:
   - 实现表单验证，确保数据格式正确
   - 提供平台选择下拉菜单
   - 显示重复记录警告信息
   - 实现错误处理和用户反馈

2. **错误处理**:
   - 422错误：显示具体的验证错误信息
   - 401错误：跳转到登录页面
   - 500错误：显示系统错误提示

3. **用户体验优化**:
   - 提供图片URL预览功能
   - 实现平台ID格式提示
   - 显示创建进度和结果反馈

---

## 2. 图片上传接口

### 2.1 接口信息

- **接口路径**: `POST /api/images/upload`
- **接口描述**: 上传图片文件到服务器，支持多种图片格式
- **认证要求**: 需要Bearer Token认证
- **请求方式**: POST
- **Content-Type**: `multipart/form-data`

### 2.2 请求头

```
Authorization: Bearer {token}
Content-Type: multipart/form-data
```

### 2.3 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| image | file | 是 | 图片文件 |

#### 参数验证规则

- `image`: 
  - 必填字段，文件类型
  - **支持格式**: jpeg, jpg, png, gif, webp
  - **文件大小**: 最大5MB (5120KB)
  - **MIME类型**: image/jpeg, image/png, image/gif, image/webp

#### 文件限制说明

1. **格式限制**: 仅支持常见的图片格式，确保安全性
2. **大小限制**: 5MB上限，平衡存储成本和用户体验
3. **安全检查**: 验证文件头信息，防止恶意文件上传

### 2.4 请求示例

#### 2.4.1 cURL 示例

```bash
curl -X POST http://localhost:8000/api/images/upload \
  -H "Authorization: Bearer 1|abcdefghijklmnopqrstuvwxyz123456789" \
  -F "image=@/path/to/your/image.jpg"
```

#### 2.4.2 JavaScript 示例

```javascript
// 基础上传功能
const uploadImage = async (file) => {
  const formData = new FormData();
  formData.append('image', file);

  try {
    const response = await fetch('http://localhost:8000/api/images/upload', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer 1|abcdefghijklmnopqrstuvwxyz123456789'
        // 注意：不要手动设置 Content-Type，让浏览器自动设置
      },
      body: formData
    });

    const result = await response.json();
    
    if (result.success) {
      console.log('上传成功:', result.data);
      return result.data;
    } else {
      console.error('上传失败:', result.message);
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('请求失败:', error);
    throw error;
  }
};

// 带进度显示的上传
const uploadImageWithProgress = (file, onProgress) => {
  return new Promise((resolve, reject) => {
    const xhr = new XMLHttpRequest();
    const formData = new FormData();
    formData.append('image', file);

    // 上传进度监听
    xhr.upload.addEventListener('progress', (event) => {
      if (event.lengthComputable) {
        const percentComplete = (event.loaded / event.total) * 100;
        onProgress(Math.round(percentComplete));
      }
    });

    // 请求完成监听
    xhr.addEventListener('load', () => {
      if (xhr.status === 200) {
        const result = JSON.parse(xhr.responseText);
        if (result.success) {
          resolve(result.data);
        } else {
          reject(new Error(result.message));
        }
      } else {
        reject(new Error(`HTTP ${xhr.status}: ${xhr.statusText}`));
      }
    });

    // 错误监听
    xhr.addEventListener('error', () => {
      reject(new Error('网络错误'));
    });

    // 发送请求
    xhr.open('POST', 'http://localhost:8000/api/images/upload');
    xhr.setRequestHeader('Authorization', 'Bearer 1|abcdefghijklmnopqrstuvwxyz123456789');
    xhr.send(formData);
  });
};

// 使用示例
const fileInput = document.getElementById('imageInput');
fileInput.addEventListener('change', async (event) => {
  const file = event.target.files[0];
  if (file) {
    try {
      // 文件大小检查
      if (file.size > 5 * 1024 * 1024) {
        alert('文件大小不能超过5MB');
        return;
      }

      // 文件类型检查
      const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
      if (!allowedTypes.includes(file.type)) {
        alert('只支持 JPEG、PNG、GIF、WebP 格式的图片');
        return;
      }

      const result = await uploadImageWithProgress(file, (progress) => {
        console.log(`上传进度: ${progress}%`);
      });
      
      console.log('上传成功，图片URL:', result.url);
    } catch (error) {
      console.error('上传失败:', error.message);
    }
  }
});
```

#### 2.4.3 Vue 3 示例

```vue
<template>
  <div class="image-upload">
    <!-- 文件选择区域 -->
    <div 
      class="upload-area"
      :class="{ 'dragover': isDragOver }"
      @drop="handleDrop"
      @dragover.prevent="isDragOver = true"
      @dragleave="isDragOver = false"
      @click="triggerFileInput"
    >
      <input 
        ref="fileInput"
        type="file" 
        accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
        @change="handleFileSelect"
        style="display: none"
      />
      
      <div v-if="!selectedFile" class="upload-placeholder">
        <div class="upload-icon">📁</div>
        <p>点击选择图片或拖拽图片到此处</p>
        <p class="upload-hint">支持 JPEG、PNG、GIF、WebP 格式，最大5MB</p>
      </div>
      
      <!-- 图片预览 -->
      <div v-else class="image-preview">
        <img :src="previewUrl" alt="预览图片" />
        <div class="image-info">
          <p><strong>文件名:</strong> {{ selectedFile.name }}</p>
          <p><strong>大小:</strong> {{ formatFileSize(selectedFile.size) }}</p>
          <p><strong>类型:</strong> {{ selectedFile.type }}</p>
        </div>
        <button @click="clearSelection" class="clear-btn">重新选择</button>
      </div>
    </div>
    
    <!-- 上传进度 -->
    <div v-if="isUploading" class="upload-progress">
      <div class="progress-bar">
        <div 
          class="progress-fill" 
          :style="{ width: uploadProgress + '%' }"
        ></div>
      </div>
      <p>上传进度: {{ uploadProgress }}%</p>
    </div>
    
    <!-- 操作按钮 -->
    <div class="upload-actions">
      <button 
        @click="uploadImage" 
        :disabled="!selectedFile || isUploading"
        class="upload-btn"
      >
        {{ isUploading ? '上传中...' : '上传图片' }}
      </button>
    </div>
    
    <!-- 上传结果 -->
    <div v-if="uploadResult" class="upload-result">
      <div class="result-success">
        <h4>✅ 上传成功！</h4>
        <p><strong>文件名:</strong> {{ uploadResult.filename }}</p>
        <p><strong>访问地址:</strong> 
          <a :href="uploadResult.url" target="_blank">{{ uploadResult.url }}</a>
        </p>
        <button @click="copyUrl" class="copy-btn">复制链接</button>
      </div>
    </div>
    
    <!-- 错误信息 -->
    <div v-if="errorMessage" class="upload-error">
      <p>❌ {{ errorMessage }}</p>
      <button @click="clearError" class="clear-error-btn">关闭</button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue'
import axios from 'axios'

// 响应式数据
const fileInput = ref<HTMLInputElement>()
const selectedFile = ref<File | null>(null)
const previewUrl = ref<string>('')
const isUploading = ref(false)
const uploadProgress = ref(0)
const uploadResult = ref<any>(null)
const errorMessage = ref<string>('')
const isDragOver = ref(false)

// 计算属性
const isValidFile = computed(() => {
  if (!selectedFile.value) return false
  
  const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp']
  const maxSize = 5 * 1024 * 1024 // 5MB
  
  return allowedTypes.includes(selectedFile.value.type) && 
         selectedFile.value.size <= maxSize
})

// 触发文件选择
const triggerFileInput = () => {
  fileInput.value?.click()
}

// 处理文件选择
const handleFileSelect = (event: Event) => {
  const target = event.target as HTMLInputElement
  const file = target.files?.[0]
  if (file) {
    setSelectedFile(file)
  }
}

// 处理拖拽上传
const handleDrop = (event: DragEvent) => {
  event.preventDefault()
  isDragOver.value = false
  
  const files = event.dataTransfer?.files
  if (files && files.length > 0) {
    setSelectedFile(files[0])
  }
}

// 设置选中的文件
const setSelectedFile = (file: File) => {
  // 文件类型检查
  const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp']
  if (!allowedTypes.includes(file.type)) {
    errorMessage.value = '只支持 JPEG、PNG、GIF、WebP 格式的图片'
    return
  }
  
  // 文件大小检查
  if (file.size > 5 * 1024 * 1024) {
    errorMessage.value = '文件大小不能超过5MB'
    return
  }
  
  selectedFile.value = file
  
  // 生成预览URL
  if (previewUrl.value) {
    URL.revokeObjectURL(previewUrl.value)
  }
  previewUrl.value = URL.createObjectURL(file)
  
  // 清除之前的结果和错误
  uploadResult.value = null
  errorMessage.value = ''
}

// 清除选择
const clearSelection = () => {
  selectedFile.value = null
  if (previewUrl.value) {
    URL.revokeObjectURL(previewUrl.value)
    previewUrl.value = ''
  }
  uploadResult.value = null
  errorMessage.value = ''
  uploadProgress.value = 0
}

// 上传图片
const uploadImage = async () => {
  if (!selectedFile.value || !isValidFile.value) return
  
  isUploading.value = true
  uploadProgress.value = 0
  errorMessage.value = ''
  
  const formData = new FormData()
  formData.append('image', selectedFile.value)
  
  try {
    const response = await axios.post('/api/images/upload', formData, {
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`,
        'Content-Type': 'multipart/form-data'
      },
      onUploadProgress: (progressEvent) => {
        if (progressEvent.total) {
          uploadProgress.value = Math.round(
            (progressEvent.loaded * 100) / progressEvent.total
          )
        }
      }
    })
    
    if (response.data.success) {
      uploadResult.value = response.data.data
      console.log('上传成功:', response.data.data)
    } else {
      errorMessage.value = response.data.message || '上传失败'
    }
  } catch (error: any) {
    console.error('上传失败:', error)
    
    if (error.response?.status === 422) {
      const errors = error.response.data.errors
      if (errors.image) {
        errorMessage.value = errors.image[0]
      } else {
        errorMessage.value = '参数验证失败'
      }
    } else if (error.response?.status === 401) {
      errorMessage.value = '认证失败，请重新登录'
    } else {
      errorMessage.value = error.message || '网络错误，请重试'
    }
  } finally {
    isUploading.value = false
  }
}

// 复制URL
const copyUrl = async () => {
  if (uploadResult.value?.url) {
    try {
      await navigator.clipboard.writeText(uploadResult.value.url)
      alert('链接已复制到剪贴板')
    } catch (error) {
      console.error('复制失败:', error)
      // 降级方案
      const textArea = document.createElement('textarea')
      textArea.value = uploadResult.value.url
      document.body.appendChild(textArea)
      textArea.select()
      document.execCommand('copy')
      document.body.removeChild(textArea)
      alert('链接已复制到剪贴板')
    }
  }
}

// 清除错误
const clearError = () => {
  errorMessage.value = ''
}

// 格式化文件大小
const formatFileSize = (bytes: number): string => {
  if (bytes === 0) return '0 Bytes'
  
  const k = 1024
  const sizes = ['Bytes', 'KB', 'MB', 'GB']
  const i = Math.floor(Math.log(bytes) / Math.log(k))
  
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
}

// 组件卸载时清理URL
import { onUnmounted } from 'vue'
onUnmounted(() => {
  if (previewUrl.value) {
    URL.revokeObjectURL(previewUrl.value)
  }
})
</script>

<style scoped>
.image-upload {
  max-width: 600px;
  margin: 0 auto;
  padding: 20px;
}

.upload-area {
  border: 2px dashed #ddd;
  border-radius: 8px;
  padding: 40px 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-bottom: 20px;
}

.upload-area:hover,
.upload-area.dragover {
  border-color: #007bff;
  background-color: #f8f9fa;
}

.upload-placeholder .upload-icon {
  font-size: 48px;
  margin-bottom: 16px;
}

.upload-placeholder p {
  margin: 8px 0;
  color: #666;
}

.upload-hint {
  font-size: 12px;
  color: #999;
}

.image-preview {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
}

.image-preview img {
  max-width: 300px;
  max-height: 200px;
  object-fit: contain;
  border-radius: 4px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.image-info {
  text-align: left;
  background: #f8f9fa;
  padding: 12px;
  border-radius: 4px;
  width: 100%;
  max-width: 300px;
}

.image-info p {
  margin: 4px 0;
  font-size: 14px;
}

.clear-btn {
  padding: 6px 12px;
  background: #6c757d;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
}

.upload-progress {
  margin-bottom: 20px;
}

.progress-bar {
  width: 100%;
  height: 8px;
  background: #e9ecef;
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 8px;
}

.progress-fill {
  height: 100%;
  background: #007bff;
  transition: width 0.3s ease;
}

.upload-actions {
  text-align: center;
  margin-bottom: 20px;
}

.upload-btn {
  padding: 12px 24px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 16px;
  cursor: pointer;
  min-width: 120px;
}

.upload-btn:disabled {
  background: #6c757d;
  cursor: not-allowed;
}

.upload-result {
  background: #d4edda;
  border: 1px solid #c3e6cb;
  border-radius: 4px;
  padding: 16px;
  margin-bottom: 20px;
}

.result-success h4 {
  margin: 0 0 12px 0;
  color: #155724;
}

.result-success p {
  margin: 8px 0;
  font-size: 14px;
}

.result-success a {
  color: #007bff;
  text-decoration: none;
  word-break: break-all;
}

.copy-btn {
  padding: 4px 8px;
  background: #28a745;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 12px;
  cursor: pointer;
  margin-top: 8px;
}

.upload-error {
  background: #f8d7da;
  border: 1px solid #f5c6cb;
  border-radius: 4px;
  padding: 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.upload-error p {
  margin: 0;
  color: #721c24;
}

.clear-error-btn {
  padding: 4px 8px;
  background: #dc3545;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 12px;
  cursor: pointer;
}
</style>
```

### 2.5 响应示例

#### 2.5.1 上传成功 (200)

```json
{
  "success": true,
  "message": "图片上传成功",
  "data": {
    "filename": "550e8400-e29b-41d4-a716-446655440000.jpg",
    "url": "http://localhost:8000/images/550e8400-e29b-41d4-a716-446655440000.jpg",
    "size": 1024000,
    "original_name": "my-photo.jpg",
    "mime_type": "image/jpeg",
    "created_at": "2024-01-20T10:30:00.000000Z"
  }
}
```

#### 2.5.2 参数验证失败 (422)

**未选择文件**:
```json
{
  "success": false,
  "message": "图片上传失败",
  "errors": {
    "image": ["请选择要上传的图片"]
  }
}
```

**文件格式错误**:
```json
{
  "success": false,
  "message": "图片上传失败",
  "errors": {
    "image": ["图片格式必须是：jpeg, jpg, png, gif, webp"]
  }
}
```

**文件大小超限**:
```json
{
  "success": false,
  "message": "图片上传失败",
  "errors": {
    "image": ["图片大小不能超过5MB"]
  }
}
```

#### 2.5.3 认证失败 (401)

```json
{
  "success": false,
  "message": "未认证"
}
```

#### 2.5.4 服务器错误 (500)

```json
{
  "success": false,
  "message": "图片上传失败：存储空间不足"
}
```

### 2.6 业务逻辑说明

1. **文件处理流程**:
   - 验证用户认证状态
   - 检查文件格式和大小限制
   - 生成唯一文件名（使用UUID）
   - 将文件保存到 `public/images` 目录
   - 返回文件访问URL和相关信息

2. **文件命名规则**:
   - 使用UUID生成唯一文件名
   - 保留原始文件扩展名
   - 格式：`{uuid}.{extension}`
   - 示例：`550e8400-e29b-41d4-a716-446655440000.jpg`

3. **存储位置**:
   - 服务器路径：`backend/public/images/`
   - 访问URL：`http://localhost:8000/images/{filename}`

4. **安全措施**:
   - 严格的文件类型验证（基于MIME类型和文件扩展名）
   - 文件大小限制（5MB）
   - 用户认证要求
   - 唯一文件名防止冲突和覆盖
   - 文件头检查防止恶意文件

### 2.7 使用说明

1. **前端集成建议**:
   - 使用 `<input type="file">` 或拖拽上传
   - 通过 FormData 构建请求体
   - 不要手动设置 Content-Type，让浏览器自动设置
   - 实现上传进度显示

2. **错误处理**:
   - 422错误：显示具体的验证错误信息
   - 401错误：跳转到登录页面
   - 500错误：显示系统错误提示，可实现重试机制

3. **用户体验优化**:
   - 图片预览功能
   - 拖拽上传支持
   - 上传进度显示
   - 文件大小和格式提示
   - 上传结果展示和链接复制

4. **性能优化**:
   - 客户端文件大小预检查
   - 图片压缩（可选）
   - 断点续传（高级功能）

---

## 联系方式

如有问题或建议，请联系：
- **邮箱**: developer@example.com
- **文档更新**: 2024-01-22
- **版本**: v1.0.0